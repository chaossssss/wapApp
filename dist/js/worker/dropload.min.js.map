{"version":3,"sources":["worker/dropload.js"],"names":["$","fnTouches","e","touches","originalEvent","fnTouchstart","me","_startY","pageY","touchScrollTop","$scrollArea","scrollTop","fnTouchmove","_curY","_moveY","direction","_absMoveY","Math","abs","opts","loadUpFn","isLockUp","preventDefault","$domUp","domUp","domClass","upInsertDOM","$element","prepend","fnTransition","distance","_offsetY","html","domRefresh","domUpdate","css","height","fnTouchend","children","domLoad","loading","on","this","remove","fnAutoLoad","autoLoad","_scrollContentHeight","_threshold","_scrollWindowHeight","loadDown","fnRecoverContentHeight","scrollArea","win","$doc","scrollHeight","$domDown","domDown","loadDownFn","dom","num","-webkit-transition","transition","window","doc","document","$win","fn","dropload","options","MyDropLoad","element","isLockDown","isData","_scrollTop","init","prototype","extend","domNoData","threshold","append","floor","documentElement","clientHeight","innerHeight","lock","undefined","unlock","noData","flag","resetload","Zepto","jQuery"],"mappings":"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","file":"worker/dropload.min.js","sourcesContent":["/**\n * dropload\n * 西门(http://ons.me/526.html)\n * 0.9.0(160215)\n */\n\n;(function($){\n    'use strict';\n    var win = window;\n    var doc = document;\n    var $win = $(win);\n    var $doc = $(doc);\n    $.fn.dropload = function(options){\n        return new MyDropLoad(this, options);\n    };\n    var MyDropLoad = function(element, options){\n        var me = this;\n        me.$element = element;\n        // 上方是否插入DOM\n        me.upInsertDOM = false;\n        // loading状态\n        me.loading = false;\n        // 是否锁定\n        me.isLockUp = false;\n        me.isLockDown = false;\n        // 是否有数据\n        me.isData = true;\n        me._scrollTop = 0;\n        me._threshold = 0;\n        me.init(options);\n    };\n\n    // 初始化\n    MyDropLoad.prototype.init = function(options){\n        var me = this;\n        me.opts = $.extend(true, {}, {\n            scrollArea : me.$element,                                            // 滑动区域\n            domUp : {                                                            // 上方DOM\n                domClass   : 'dropload-up',\n                domRefresh : '<div class=\"dropload-refresh\">↓下拉刷新</div>',\n                domUpdate  : '<div class=\"dropload-update\">↑释放更新</div>',\n                domLoad    : '<div class=\"dropload-load\"><span class=\"loading\"></span>加载中...</div>'\n            },\n            domDown : {                                                          // 下方DOM\n                domClass   : 'dropload-down',\n                domRefresh : '<div class=\"dropload-refresh\">↑上拉加载更多</div>',\n                domLoad    : '<div class=\"dropload-load\"><span class=\"loading\"></span>加载中...</div>',\n                domNoData  : '<div class=\"dropload-noData\">暂无数据</div>'\n            },\n            autoLoad : true,                                                     // 自动加载\n            distance : 50,                                                       // 拉动距离\n            threshold : '',                                                      // 提前加载距离\n            loadUpFn : '',                                                       // 上方function\n            loadDownFn : ''                                                      // 下方function\n        }, options);\n\n        // 如果加载下方，事先在下方插入DOM\n        if(me.opts.loadDownFn != ''){\n            me.$element.append('<div class=\"'+me.opts.domDown.domClass+'\">'+me.opts.domDown.domRefresh+'</div>');\n            me.$domDown = $('.'+me.opts.domDown.domClass);\n        }\n\n        // 计算提前加载距离\n        if(!!me.$domDown && me.opts.threshold === ''){\n            // 默认滑到加载区2/3处时加载\n            me._threshold = Math.floor(me.$domDown.height()*1/3);\n        }else{\n            me._threshold = me.opts.threshold;\n        }\n\n        // 判断滚动区域\n        if(me.opts.scrollArea == win){\n            me.$scrollArea = $win;\n            // 获取文档高度\n            me._scrollContentHeight = $doc.height();\n            // 获取win显示区高度  —— 这里有坑\n            me._scrollWindowHeight = doc.documentElement.clientHeight;\n        }else{\n            me.$scrollArea = me.opts.scrollArea;\n            me._scrollContentHeight = me.$element[0].scrollHeight;\n            me._scrollWindowHeight = me.$element.height();\n        }\n        fnAutoLoad(me);\n\n        // 窗口调整\n        $win.on('resize',function(){\n            if(me.opts.scrollArea == win){\n                // 重新获取win显示区高度\n                me._scrollWindowHeight = win.innerHeight;\n            }else{\n                me._scrollWindowHeight = me.$element.height();\n            }\n        });\n\n        // 绑定触摸\n        me.$element.on('touchstart',function(e){\n            if(!me.loading){\n                fnTouches(e);\n                fnTouchstart(e, me);\n            }\n        });\n        me.$element.on('touchmove',function(e){\n            if(!me.loading){\n                fnTouches(e, me);\n                fnTouchmove(e, me);\n            }\n        });\n        me.$element.on('touchend',function(){\n            if(!me.loading){\n                fnTouchend(me);\n            }\n        });\n\n        // 加载下方\n        me.$scrollArea.on('scroll',function(){\n            me._scrollTop = me.$scrollArea.scrollTop();\n\n            // 滚动页面触发加载数据\n            if(me.opts.loadDownFn != '' && !me.loading && !me.isLockDown && (me._scrollContentHeight - me._threshold) <= (me._scrollWindowHeight + me._scrollTop)){\n                loadDown(me);\n            }\n        });\n    };\n\n    // touches\n    function fnTouches(e){\n        if(!e.touches){\n            e.touches = e.originalEvent.touches;\n        }\n    }\n\n    // touchstart\n    function fnTouchstart(e, me){\n        me._startY = e.touches[0].pageY;\n        // 记住触摸时的scrolltop值\n        me.touchScrollTop = me.$scrollArea.scrollTop();\n    }\n\n    // touchmove\n    function fnTouchmove(e, me){\n        me._curY = e.touches[0].pageY;\n        me._moveY = me._curY - me._startY;\n\n        if(me._moveY > 0){\n            me.direction = 'down';\n        }else if(me._moveY < 0){\n            me.direction = 'up';\n        }\n\n        var _absMoveY = Math.abs(me._moveY);\n\n        // 加载上方\n        if(me.opts.loadUpFn != '' && me.touchScrollTop <= 0 && me.direction == 'down' && !me.isLockUp){\n            e.preventDefault();\n\n            me.$domUp = $('.'+me.opts.domUp.domClass);\n            // 如果加载区没有DOM\n            if(!me.upInsertDOM){\n                me.$element.prepend('<div class=\"'+me.opts.domUp.domClass+'\"></div>');\n                me.upInsertDOM = true;\n            }\n            \n            fnTransition(me.$domUp,0);\n\n            // 下拉\n            if(_absMoveY <= me.opts.distance){\n                me._offsetY = _absMoveY;\n                // todo：move时会不断清空、增加dom，有可能影响性能，下同\n                me.$domUp.html(me.opts.domUp.domRefresh);\n            // 指定距离 < 下拉距离 < 指定距离*2\n            }else if(_absMoveY > me.opts.distance && _absMoveY <= me.opts.distance*2){\n                me._offsetY = me.opts.distance+(_absMoveY-me.opts.distance)*0.5;\n                me.$domUp.html(me.opts.domUp.domUpdate);\n            // 下拉距离 > 指定距离*2\n            }else{\n                me._offsetY = me.opts.distance+me.opts.distance*0.5+(_absMoveY-me.opts.distance*2)*0.2;\n            }\n\n            me.$domUp.css({'height': me._offsetY});\n        }\n    }\n\n    // touchend\n    function fnTouchend(me){\n        var _absMoveY = Math.abs(me._moveY);\n        if(me.opts.loadUpFn != '' && me.touchScrollTop <= 0 && me.direction == 'down' && !me.isLockUp){\n            fnTransition(me.$domUp,300);\n\n            if(_absMoveY > me.opts.distance){\n                me.$domUp.css({'height':me.$domUp.children().height()});\n                me.$domUp.html(me.opts.domUp.domLoad);\n                me.loading = true;\n                me.opts.loadUpFn(me);\n            }else{\n                me.$domUp.css({'height':'0'}).on('webkitTransitionEnd mozTransitionEnd transitionend',function(){\n                    me.upInsertDOM = false;\n                    $(this).remove();\n                });\n            }\n            me._moveY = 0;\n        }\n    }\n\n    // 如果文档高度不大于窗口高度，数据较少，自动加载下方数据\n    function fnAutoLoad(me){\n        if(me.opts.autoLoad){\n            if((me._scrollContentHeight - me._threshold) <= me._scrollWindowHeight){\n                loadDown(me);\n            }\n        }\n    }\n\n    // 重新获取文档高度\n    function fnRecoverContentHeight(me){\n        if(me.opts.scrollArea == win){\n            me._scrollContentHeight = $doc.height();\n        }else{\n            me._scrollContentHeight = me.$element[0].scrollHeight;\n        }\n    }\n\n    // 加载下方\n    function loadDown(me){\n        me.direction = 'up';\n        me.$domDown.html(me.opts.domDown.domLoad);\n        me.loading = true;\n        me.opts.loadDownFn(me);\n    }\n\n    // 锁定\n    MyDropLoad.prototype.lock = function(direction){\n        var me = this;\n        // 如果不指定方向\n        if(direction === undefined){\n            // 如果操作方向向上\n            if(me.direction == 'up'){\n                me.isLockDown = true;\n            // 如果操作方向向下\n            }else if(me.direction == 'down'){\n                me.isLockUp = true;\n            }else{\n                me.isLockUp = true;\n                me.isLockDown = true;\n            }\n        // 如果指定锁上方\n        }else if(direction == 'up'){\n            me.isLockUp = true;\n        // 如果指定锁下方\n        }else if(direction == 'down'){\n            me.isLockDown = true;\n            // 为了解决DEMO5中tab效果bug，因为滑动到下面，再滑上去点tab，direction=down，所以有bug\n            me.direction = 'up';\n        }\n    };\n\n    // 解锁\n    MyDropLoad.prototype.unlock = function(){\n        var me = this;\n        // 简单粗暴解锁\n        me.isLockUp = false;\n        me.isLockDown = false;\n        // 为了解决DEMO5中tab效果bug，因为滑动到下面，再滑上去点tab，direction=down，所以有bug\n        me.direction = 'up';\n    };\n\n    // 无数据\n    MyDropLoad.prototype.noData = function(flag){\n        var me = this;\n        if(flag === undefined || flag == true){\n            me.isData = false;\n        }else if(flag == false){\n            me.isData = true;\n        }\n    };\n\n    // 重置\n    MyDropLoad.prototype.resetload = function(){\n        var me = this;\n        if(me.direction == 'down' && me.upInsertDOM){\n            me.$domUp.css({'height':'0'}).on('webkitTransitionEnd mozTransitionEnd transitionend',function(){\n                me.loading = false;\n                me.upInsertDOM = false;\n                $(this).remove();\n                fnRecoverContentHeight(me);\n            });\n        }else if(me.direction == 'up'){\n            me.loading = false;\n            // 如果有数据\n            if(me.isData){\n                // 加载区修改样式\n                me.$domDown.html(me.opts.domDown.domRefresh);\n                fnRecoverContentHeight(me);\n                fnAutoLoad(me);\n            }else{\n                // 如果没数据\n                me.$domDown.html(me.opts.domDown.domNoData);\n            }\n        }\n    };\n\n    // css过渡\n    function fnTransition(dom,num){\n        dom.css({\n            '-webkit-transition':'all '+num+'ms',\n            'transition':'all '+num+'ms'\n        });\n    }\n})(window.Zepto || window.jQuery);"],"sourceRoot":"/source/"}